!function(){"use strict";!function(){const e="https://x8ki-letl-twmt.n7.xano.io/api:ZvUi_3ML/users";let t="email",n=null;function o(...e){console.log("[ML Form]",...e)}function r(e,t){a(e);const n=document.createElement("div");n.className="error-message",n.textContent=t,e.parentNode.appendChild(n),e.classList.add("error")}function a(e){const t=e.parentNode.querySelector(".error-message");t&&t.remove(),e.classList.remove("error")}function i(e){const t=document.querySelector(`[ml="${e}-step"]`);if(t){t.style.display="block";const n=t.querySelector(`[ml="${e}"]`);n&&n.focus()}}function c(){try{!function(){const e=document.createElement("style");e.textContent='\n      .error { border-color: red; }\n      [ml$="-step"] { display: none; }\n      .error-message { color: red; font-size: 12px; margin-top: 5px; }\n    ',document.head.appendChild(e)}();const e=document.querySelector('[ml="form"]');if(!e)throw new Error('No form with ml="form" found');e.addEventListener("click",s),e.addEventListener("keydown",l),i("email"),o("Multi-step form initialized")}catch(e){console.error("Error initializing form:",e)}}function s(e){const t=e.target;t.matches('[ml="next"]')?(e.preventDefault(),m()):t.matches('[ml="submit"]')&&(e.preventDefault(),d())}function l(e){"Enter"===e.key&&(e.preventDefault(),"email"===t?m():d())}async function m(){if(function(e){const t=document.querySelector(`[ml="${e}"]`);if(!t?.value.trim())return r(t,"This field is required."),!1;return a(t),"email"!==e||function(e){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(String(e).toLowerCase())}(t.value)}(t)){if(u(t),"email"===t)try{if(n=await async function(t){try{const n=await fetch(`${e}/${encodeURIComponent(t)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(404===n.status)return{email:t,first_name:"",last_name:"",company:""};if(!n.ok){const e=await n.json();throw new Error(e.message||"Failed to fetch user data")}return n.json()}catch(e){throw console.error("Error in fetchUserData:",e),e}}(n.email),o("User data fetched:",n),c=n,["email","first_name","last_name","company"].every((e=>""!==c?.[e]?.trim())))return void await d()}catch(e){return console.error("Error fetching user data:",e),void r(document.querySelector(`[ml="${t}"]`),e.message)}const a=function(){const e=["email","first_name","last_name","company"];for(let o=e.indexOf(t)+1;o<e.length;o++)if(!n?.[e[o]]?.trim())return e[o];return null}();a?(!function(e){const t=document.querySelector(`[ml="${e}-step"]`);t&&(t.style.display="none")}(t),i(a),t=a):await d()}var c}function u(e){n||(n={});const t=document.querySelector(`[ml="${e}"]`);t&&(n[e]=t.value)}async function d(){try{if(!n?.email)throw new Error("User data is not properly initialized");u(t),o("Submitting form with user data:",n),await async function(t){const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const e=await n.json();throw new Error(e.message||"Failed to submit form to API")}return n.json()}(n),o("Form submitted successfully to API"),Object.entries(n).forEach((([e,t])=>{const n=document.querySelector(`[ml="${e}"]`);n&&(n.value=t)}));const r=document.querySelector('[ml="form"]'),a=new Event("submit",{bubbles:!0,cancelable:!0});r.dispatchEvent(a)}catch(e){console.error("Error submitting form:",e),r(document.querySelector(`[ml="${t}"]`),e.message||"Failed to submit form. Please try again.")}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c()}()}();
